@page
@model PRN221_GroupProject.Pages.Cart.CartModel
@{
    ViewData["Title"] = "ShoppingCart";
    var format = System.Globalization.CultureInfo.GetCultureInfo("vi-VN");
}

<head>
    @* Shopping cart css *@
    <link rel="stylesheet" href="~/css/ShoppingCart.css" />
    @* Bootstrap *@
    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.css" />
    @* font awesome *@
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
          integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A=="
          crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>

<body>
    <h1>Shopping Cart</h1>

    <div class="container shopping-cart-containner">
        <div class="return-pages"><a asp-page="/customerproducts/index">Continuing shopping</a></div>
        <div class="row column-grid g-0">

            <div class="cart-table-header col-md-8">
                <div class="column-labels">
                    <div class="form-check col-md-6 cart-checkbox">
                        <input class="form-check-input" type="checkbox" value="">
                        <label class="cart-checkbox-label">Select all [ <small>@Model.CartDetail.Count Item(s)</small> ]</label>
                    </div>
                    <label class="product-price-label col-md-1">Unit Price</label>
                    <label class="product-quantity-label col-md-2">Quantity</label>
                    <label class="product-category-unit-label col-md-2">Amount</label>
                </div>
            </div>

            <div class="cart-table-body col-md-8">
                @foreach (var productCart in Model.CartDetail)
                {
                    <div class="product-container">

                        <div class="product-info col-md-6">
                            <div class="form-check product-checkbox">
                                <input class="form-check-input" type="checkbox" value="" id="flexCheckDefault">
                            </div>

                            <div class="product-image">
                                <img src="@productCart.Product.ImageUrl" width="40px" height="50px">
                            </div>

                            <div class="product-details">
                                <div class="product-name">@productCart.Product.Name</div>
                                <p class="product-description">@productCart.Product.Description</p>
                            </div>
                        </div>

                        <div class="product-price col-md-1">@productCart.Product.Price</div>

                        <div class="product-quantity col-md-2">
                            <form method="post" asp-page-handler="Update">
                                <input class="product-quantity-input" asp-for="CartDetailPostModel.Count" type="number" value="@productCart.Count" min="1">
                                <input asp-for="CartDetailPostModel.ProductId" type="hidden" value="@productCart.ProductId" />
                                <input asp-for="CartDetailPostModel.CartDetailId" type="hidden" value="@productCart.CartDetailId" />
                            </form>
                        </div>

                        <div class="dropdown col-md-2 product-line-price">
                            @productCart.Product.Price
                        </div>

                        <div class="product-removal col-md-1">
                            <form method="post" asp-page-handler="Remove" onsubmit="return confirm('Are you sure you want to delete this product?');">
                                <button class="remove-product-btn" type="submit">
                                    <i class="fa-solid fa-trash">
                                        <input type="hidden" asp-for="CartDetailPostModel.CartDetailId" value="@productCart.CartDetailId" />
                                    </i>
                                </button>
                            </form>
                        </div>
                    </div>
                }
            </div>

            <div class="cart-total col-md-3 offset-md-1">
                    <div class="totals">
                        <div class="totals-item">
                            <label class="item-label">Subtotal</label>
                            <div class="totals-value" id="cart-subtotal">0</div>
                        </div>
                        <div class="totals-item totals-item-total">
                            <label class="item-label-total">Grand Total</label>
                            <div class="totals-value" id="grand-total">0</div>
                        </div>
                        <div class="totals-item-checkout-btn">
                            <a asp-page="/cart/checkout"><button class="cart-checkout-btn">Checkout</button></a>
                        </div>
                    </div>
                </div>
            </div>
            
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const quantityInputs = document.querySelectorAll('.product-quantity-input');
            const cartSubtotalElement = document.getElementById('cart-subtotal');
            const cartGrandTotalElement = document.getElementById('grand-total');
            const format = new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' });

            function updateCart() {
                let subtotal = 0;

                quantityInputs.forEach(input => {
                    const productContainer = input.closest('.product-container');
                    const priceElement = productContainer.querySelector('.product-price');
                    const linePriceElement = productContainer.querySelector('.product-line-price');

                    const price = parseFloat(priceElement.textContent.replace(/\D/g, ''));
                    const quantity = parseInt(input.value);

                    const linePrice = price * quantity;
                    linePriceElement.textContent = format.format(linePrice);

                    subtotal += linePrice;
                });

                cartSubtotalElement.textContent = format.format(subtotal);
                cartGrandTotalElement.textContent = format.format(subtotal);
            }

            quantityInputs.forEach(input => {
                input.addEventListener('input', updateCart);
            });

            updateCart();
        });
    </script>

</body>



