@page
@model PRN221_GroupProject.Pages.User.IndexModel
@* @using PRN221_GroupProject.Models *@

<h2>User List</h2>

<!-- Create Button -->
<div class="button_group">
    <a asp-page="Create" class="btn btn-primary">Add New</a>

    <form method="get">
        <div class="form-group">
            <input type="text" name="searchTermParam" value="@Model.SearchTerm" class="form-control" placeholder="Search by username or email" />
            <button type="submit" class="btn btn-primary">Search</button>
        </div>
    </form>
</div>


<div>
<!-- Data table -->
<table class="table">
    <thead>
        <tr>
            <th>Name</th>
            <th>Email</th>
            <th>Phone Number</th>
            <th>Roles</th>
            <th>Status</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var user in Model.Users)
        {
            <tr>
                <td>@user.User.Name</td>
                <td>@user.User.Email</td>
                <td>@user.User.PhoneNumber</td>
                <td>
                    @foreach (var role in user.Roles)
                    {
                        <span>@role</span><br />
                    }
                </td>
                <td>@(user.User.Status ? "Active" : "NonActive")</td> 
 <!-- Delete Button -->
                <td>
                    <form method="post" asp-page-handler="Delete" asp-route-id="@user.User.Id" onsubmit="return confirm('Are you sure you want to delete this user?');">
                        <button type="submit" class="btn btn-danger">Delete</button>
                    </form>
                </td>
            </tr>
        }
    </tbody>
</table>

<!-- Pagination -->
<nav aria-label="Page navigation example" class="d-flex justify-content-between mh-75 align-items-center">
    <div class="w-1 h-1"></div>
    <ul class="pagination">
        <li class="page-item @(Model.PageNumber == 1 ? "disabled" : "")">
            <a class="page-link"
               href="?pageNumberParam=@(Model.PageNumber - 1)&pageSizeParam=@Model.PageSize@(Model.SearchTerm?.Length > 0 ? "&searchtermParam=" + Model.SearchTerm : "" )"
               aria-label="Previous">
                <span aria-hidden="true">&laquo;</span>
                <span class="sr-only">Previous</span>
            </a>
        </li>

        @for (int i = 1; i <= Model.TotalPages; i++)
        {
            int gap = Math.Abs(i - Model.PageNumber);

            if (i == 1 || i == Model.TotalPages || gap <= 3)
            {
                <li class="page-item @(Model.PageNumber == i ? "active" : "")">
                    <a class="page-link"
                       href="?pageNumberParam=@i&pageSizeParam=@Model.PageSize@(Model.SearchTerm?.Length > 0 ? "&searchtermParam=" + Model.SearchTerm : "" )">@i</a>
                </li>
            }
            else if (gap == 4)
            {
                <li class="page-item disabled">
                    <span class="page-link">...</span>
                </li>
            }
        }

        <li class="page-item @(Model.PageNumber == Model.TotalPages ? "disabled" : "")">
            <a class="page-link"
               href="?pageNumberParam=@(Model.PageNumber + 1)&pageSizeParam=@Model.PageSize@(Model.SearchTerm?.Length > 0 ? "&searchtermParam=" + Model.SearchTerm : "" )"
               aria-label="Next">
                <span aria-hidden="true">&raquo;</span>
                <span class="sr-only">Next</span>
            </a>
        </li>
    </ul>

    <select id="PageSize" class="mh-30px">
        @for (int i = 1; i <= 5; i++)
        {
            int value = i * 5;
            <option selected="@(value == Model.PageSize)" value="@value">@value</option>
        }
    </select>
</nav>

    @* Change row perpage *@
    <script>
        document.getElementById('PageSize').addEventListener('change', function () {
            var selectedPageSize = this.value;
            console.log(selectedPageSize);
            var currentPageNumber = @Model.PageNumber;
            var searchTerm = '@Model.SearchTerm';
            window.location.href = `?pageNumberParam=${currentPageNumber}&pageSizeParam=${selectedPageSize}` + (searchTerm ? `&searchTermParam=${searchTerm}` : '');
        });
    </script>
</div>
